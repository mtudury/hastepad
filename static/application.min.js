var haste_document=function(){this.locked=!1};haste_document.prototype.htmlEscape=function(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},haste_document.prototype.load=function(t,e,o){var n=this;$.ajax("/documents/"+t,{type:"get",dataType:"json",success:function(o){n.locked=!0,n.key=t,n.data=o.data,e({value:o.data,key:t})},error:function(){e(!1)}})},haste_document.prototype.save=function(t,e,o){if(this.locked)return!1;this.data=e;var n=this;$(".logo").addClass("logo_save"),window.setTimeout(function(){$(".logo").removeClass("logo_save")},300),$.ajax("/documents/"+t,{type:"post",data:e,dataType:"json",contentType:"text/plain; charset=utf-8",success:function(t,e,s){n.key=t.key,o(null,{value:t.data,key:t.key,statusCode:s.status})},error:function(t){try{o($.parseJSON(t.responseText))}catch(t){o({message:"Something went wrong!"})}}})},haste_document.prototype.deleteDocument=function(t,e){if(!this.locked)return!1;$.ajax("/documents/"+t,{type:"delete",success:function(t){e(null,t)},error:function(t){try{e($.parseJSON(t.responseText))}catch(t){e({message:"Something went wrong!"})}}})},haste_document.prototype.getkey=function(t){$.ajax("/key/",{type:"get",success:function(e){t(null,e)},error:function(e){try{t($.parseJSON(e.responseText))}catch(e){t({message:"Something went wrong!"})}}})};var haste=function(t,e){this.appName=t,this.$textarea=$("textarea"),this.options=e,this.configureShortcuts(),this.configureButtons(),this.showKeys=!0,e.twitter||$("#box2 .twitter").hide(),_this=this,$(".logo").click(function(t){t.preventDefault(),_this.showKeys?(_this.showKeys=!1,$("#key").css("height","40px")):(_this.showKeys=!0,$("#key").css("height","auto"))})};haste.prototype.setTitle=function(t){var e=t?this.appName+" - "+t:this.appName;document.title=e},haste.prototype.updateKeySize=function(){$(".CodeMirror-fullscreen").css("right",$("#key").outerWidth())},haste.prototype.showMessage=function(t,e){var o=$('<li class="'+(e||"info")+'">'+t+"</li>");$("#messages").prepend(o),setTimeout(function(){o.slideUp("fast",function(){$(this).remove()})},3e3)},haste.prototype.lightKey=function(){this.configureKey(["new","save"])},haste.prototype.fullKey=function(){var t=["new","duplicate","edit","raw"];config.allowDelete&&t.push("delete"),this.configureKey(t)},haste.prototype.allKey=function(){var t=["new","save","duplicate","edit","raw"];config.allowDelete&&t.push("delete"),this.configureKey(t)},haste.prototype.showEditor=function(t){_this=this,this.editor||(CodeMirror.modeURL="/mode/%N/%N.js",this.editor=CodeMirror.fromTextArea(this.$textarea[0],{styleActiveLine:!0,lineNumbers:!0,fullScreen:!0,theme:"material",autofocus:!0}),this.editor.on("changes",function(){_this.doc&&(_this.doc.changed=!0)}),this.updateKeySize()),(m=/.+\.([^.]+)$/.exec(t))&&(mode=CodeMirror.findModeByExtension(m[1]),CodeMirror.autoLoadMode(this.editor,mode.mode),this.editor.setOption("mode",mode.mime))},haste.prototype.configureKey=function(t){var e,o=0;$("#box2 .function").each(function(){for(e=$(this),o=0;o<t.length;o++)if(e.hasClass(t[o]))return e.addClass("enabled"),!0;e.removeClass("enabled")})},haste.prototype.getCurrentKey=function(){var t=window.location.pathname;return t="/"==t?null:t.substr(1)},haste.prototype.getList=function(t){config.allowList&&$.ajax("/documents/",{type:"get",dataType:"json",success:function(e){t(e)},error:function(){t(!1)}})},haste.prototype.newDocument=function(t,e){var o=this,n=this.getCurrentKey(),s=function(t){window.history.pushState(null,o.appName,"/"+t),o.doc=new haste_document,o.setTitle(),o.lightKey(),o.showEditor(t),o.editor.setValue(""),o.editor.setOption("readOnly",!1),o.editor.setOption("cursorBlinkRate",530),o.editor.focus(),e&&e(o.doc)};n&&!t?s(n):haste_document.prototype.getkey(function(t,e){s(e)}),o.updateList()},haste.prototype.loadDocument=function(t){var e=this;e.doc=new haste_document,e.doc.load(t,function(o){o?(e.showEditor(t),e.editor.setValue(o.value),e.setTitle(o.key),e.fullKey(),e.editor.setOption("readOnly",!0),e.editor.setOption("cursorBlinkRate",-1)):e.newDocument()}),this.updateList()},haste.prototype.duplicateDocument=function(){var t=this;if(t.doc.locked){var e=t.doc.data;t.newDocument(!0,function(){t.editor.setValue(e)})}},haste.prototype.lockDocument=function(){var t=this;this.doc.save(this.getCurrentKey(),this.editor.getValue(),function(e,o){e?t.showMessage(e.message,"error"):o&&(t.doc.locked=!0,t.editor.setOption("readOnly",!0),t.editor.setOption("cursorBlinkRate",-1),t.fullKey(),201==o.statusCode&&t.updateList())})},haste.prototype.unlockDocument=function(){var t=this;t.doc.locked=!1,t.editor.setOption("readOnly",!1),t.editor.setOption("cursorBlinkRate",530),t.editor.focus(),t.lightKey()},haste.prototype.configureButtons=function(){var t=this;this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(t){return t.ctrlKey&&83===t.keyCode},action:function(){""!==t.editor.getValue().replace(/^\s+|\s+$/g,"")&&t.lockDocument()}},{$where:$("#box2 .new"),label:"New",shortcut:function(t){return t.ctrlKey&&78===t.keyCode},shortcutDescription:"control + n",action:function(){t.newDocument(!0)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(e){return t.doc.locked&&e.ctrlKey&&68===e.keyCode},shortcutDescription:"control + d",action:function(){t.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:function(t){return t.ctrlKey&&t.shiftKey&&82===t.keyCode},shortcutDescription:"control + shift + r",action:function(){window.location.href="/raw/"+t.doc.key}},{$where:$("#box2 .edit"),label:"Edit",shortcut:function(e){return t.doc.locked&&e.shiftKey&&e.ctrlKey&&84==e.keyCode},shortcutDescription:"control + shift + t",action:function(){t.unlockDocument()}},{$where:$("#box2 .delete"),label:"Delete",shortcut:function(t){return!1},shortcutDescription:"none",action:function(){t.doc.deleteDocument(t.getCurrentKey(),function(){t.editor.setValue(""),t.showMessage("Deleted"),t.updateList()})},shown:function(){return config.allowDelete}}];for(var e=0;e<this.buttons.length;e++)this.configureButton(this.buttons[e])},haste.prototype.configureButton=function(t){t.shown&&!t.shown()&&t.$where.hide(),t.$where.click(function(e){e.preventDefault(),!t.clickDisabled&&$(this).hasClass("enabled")&&t.action()}),t.$where.mouseenter(function(){$("#box3 .label").text(t.label),$("#box3 .shortcut").text(t.shortcutDescription||""),$("#box3").show(),$(this).append($("#pointer").remove().show())}),t.$where.mouseleave(function(){$("#box3").hide(),$("#pointer").hide()})},haste.prototype.updateList=function(){var t=this;t.getList(function(e){if(e){var o="",n=0;e.forEach(function(t){n<150&&(o+='<li><a href="'+t+'">'+t+"</a></li>"),n++}),$("#list").html(o),t.updateKeySize()}})},haste.prototype.configureShortcuts=function(){var t=this;$(document.body).keydown(function(e){for(var o,n=0;n<t.buttons.length;n++)if((o=t.buttons[n]).shortcut&&o.shortcut(e))return e.preventDefault(),void o.action()})},haste.prototype.autosave=function(){var t=this,e=function(){t.doc&&!t.doc.locked&&t.doc.changed&&(t.doc.save(t.getCurrentKey(),t.editor.getValue(),function(e,o){e?t.showMessage("Error "+e):201==o.statusCode&&t.updateList()}),t.doc.changed=!1),window.setTimeout(e,5e3)};window.setTimeout(e,5e3)},$(function(){$("textarea").keydown(function(t){if(9===t.keyCode){t.preventDefault();if(document.selection)this.focus(),document.selection.createRange().text="  ",this.focus();else if(this.selectionStart||"0"==this.selectionStart){var e=this.selectionStart,o=this.selectionEnd,n=this.scrollTop;this.value=this.value.substring(0,e)+"  "+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=e+"  ".length,this.selectionEnd=e+"  ".length,this.scrollTop=n}else this.value+="  ",this.focus()}})});